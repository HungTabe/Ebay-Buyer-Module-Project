@page
@model CloneEbay.Pages.PaymentModel
@{
    ViewData["Title"] = "Thanh toán";
}

<h2 class="mt-4 mb-4">Thanh toán đơn hàng</h2>

@if (Model.Order == null)
{
    <div class="alert alert-danger">Không tìm thấy đơn hàng.</div>
}
else
{
    <div class="card mb-4">
        <div class="card-header">
            <b>Thông tin đơn hàng #@Model.Order.Id</b>
        </div>
        <div class="card-body">
            <p><b>Ngày đặt:</b> @Model.Order.OrderDate?.ToString("dd/MM/yyyy HH:mm")</p>
            <p><b>Địa chỉ giao hàng:</b><br />
                @Model.Order.Address?.FullName - @Model.Order.Address?.Phone<br />
                @Model.Order.Address?.Street, @Model.Order.Address?.City, @Model.Order.Address?.State, @Model.Order.Address?.Country, @Model.Order.Address?.PostalCode
            </p>
            <table class="table table-bordered align-middle">
                <thead>
                    <tr>
                        <th>Tên sản phẩm</th>
                        <th>Số lượng</th>
                        <th>Đơn giá</th>
                        <th>Thành tiền</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Order.OrderItems)
                    {
                        <tr>
                            <td>@item.Product?.Title</td>
                            <td>@item.Quantity</td>
                            <td>$@item.UnitPrice?.ToString("F2")</td>
                            <td>$@((item.UnitPrice ?? 0) * (item.Quantity ?? 0)).ToString("F2")</td>
                        </tr>
                    }
                </tbody>
            </table>
            <div class="text-end">
                <b>Tổng cộng: $@Model.Order.TotalPrice?.ToString("F2")</b>
            </div>
        </div>
    </div>
    @if (string.IsNullOrEmpty(Model.Message))
    {
        <form method="post">
            <input type="hidden" name="orderId" value="@Model.Order.Id" />
            <button type="submit" asp-page-handler="Pay" class="btn btn-success btn-lg">Thanh toán qua PayOS (giả lập)</button>
        </form>
    }
    else
    {
        <div class="alert alert-success">@Model.Message</div>
        <a href="/Products" class="btn btn-primary">Tiếp tục mua sắm</a>
    }
} 